import{j as e,b as y}from"./index-Dzgg_pch.js";import{a as c,G as U,S,c as k,f as j,y as z,H as E,J as R,K as M,n as D,M as W}from"./icons-Dgo8FfWk.js";import"./firebase-t0qY4c1R.js";const F={admin:"bg-red-100 text-red-700 border-red-200",manager:"bg-purple-100 text-purple-700 border-purple-200",editor:"bg-blue-100 text-blue-700 border-blue-200",viewer:"bg-gray-100 text-gray-700 border-gray-200"},H=({show:$,team:n,setTeam:u,onClose:N})=>{const[h,f]=c.useState(null),[m,v]=c.useState(""),[d,P]=c.useState(null),[p,T]=c.useState(""),[g,x]=c.useState(!1),l=c.useMemo(()=>{const s=n.filter(a=>a.password&&a.password.startsWith("$2")).length,r=n.filter(a=>a.password&&!a.password.startsWith("$2")).length,t=n.filter(a=>a.requirePasswordChange).length,i=n.filter(a=>!a.password).length;return{encrypted:s,plainText:r,requireChange:t,noPassword:i,total:n.length}},[n]),b=c.useMemo(()=>{if(!p.trim())return n;const s=p.toLowerCase();return n.filter(r=>r.name.toLowerCase().includes(s)||r.role.toLowerCase().includes(s))},[n,p]);if(!$)return null;const o=(s,r)=>{P({type:s,text:r}),setTimeout(()=>P(null),4e3)},q=async(s,r)=>{if(window.confirm(`Reset password for this user to: ${r}?`)){x(!0);try{const t=await y.hash(r,10);u(a=>a.map(w=>w.id===s?{...w,password:t,requirePasswordChange:!0}:w));const i=n.find(a=>a.id===s)?.name;o("success",`Password reset for ${i}`),f(null)}catch{o("error","Failed to reset password")}finally{x(!1)}}},C=async s=>{if(!m.trim()){o("error","Please enter a password");return}if(m.length<4){o("error","Password must be at least 4 characters");return}x(!0);try{const r=await y.hash(m,10);u(i=>i.map(a=>a.id===s?{...a,password:r,requirePasswordChange:!0}:a));const t=n.find(i=>i.id===s)?.name;o("success",`Password set for ${t}`),v(""),f(null)}catch{o("error","Failed to set password")}finally{x(!1)}},A=async()=>{if(l.plainText===0){o("info","All passwords are already encrypted!");return}if(window.confirm(`This will encrypt ${l.plainText} plain-text password(s). All affected users will need to change their password on next login. Continue?`)){x(!0),o("info","Encrypting passwords...");try{const s=await Promise.all(n.map(async r=>{if(!r.password||r.password.startsWith("$2"))return r;const t=await y.hash(r.password,10);return{...r,password:t,requirePasswordChange:!0}}));u(s),o("success",`Successfully encrypted ${l.plainText} password(s)!`)}catch{o("error","Failed to encrypt passwords")}finally{x(!1)}}},L=s=>!!s&&s.startsWith("$2");return e.jsxs("div",{className:"w-full bg-white shadow-lg overflow-y-auto flex flex-col h-full",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-red-700 text-white p-5 border-b shadow-md z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[N&&e.jsx("button",{onClick:N,className:"p-2 bg-white/10 rounded-lg hover:bg-white/20 transition-colors",title:"Return to Dashboard",children:e.jsx(U,{size:24})}),e.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:e.jsx(S,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-xl",children:"User Security"}),e.jsx("p",{className:"text-xs text-red-100",children:"Password & Access Management"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-red-100",children:"Total Users"}),e.jsx("div",{className:"text-2xl font-bold",children:l.total})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-red-100",children:"Encrypted"}),e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[l.encrypted,l.plainText===0&&e.jsx(k,{size:16})]})]}),l.plainText>0&&e.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-yellow-100",children:"Plain-text"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-200 flex items-center gap-1",children:[l.plainText,e.jsx(j,{size:16})]})]}),l.requireChange>0&&e.jsxs("div",{className:"bg-orange-500/20 border border-orange-400/30 rounded-lg p-2",children:[e.jsx("div",{className:"text-xs text-orange-100",children:"Needs Change"}),e.jsx("div",{className:"text-2xl font-bold text-orange-200",children:l.requireChange})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-200 text-green-700":d.type==="error"?"bg-red-50 border-red-200 text-red-700":"bg-blue-50 border-blue-200 text-blue-700"} border p-3 rounded-lg text-sm flex items-start gap-2`,children:[d.type==="success"&&e.jsx(k,{size:16,className:"mt-0.5 flex-shrink-0"}),d.type==="error"&&e.jsx(j,{size:16,className:"mt-0.5 flex-shrink-0"}),d.type==="info"&&e.jsx(S,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("span",{children:d.text})]}),l.plainText>0&&e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-300 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(j,{size:20,className:"text-yellow-700"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:"Security Warning"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[l.plainText," user",l.plainText>1?"s have":" has"," plain-text password",l.plainText>1?"s":"",". Encrypt them to improve security."]})]})]}),e.jsxs("button",{onClick:A,disabled:g,className:"w-full px-4 py-2.5 bg-gradient-to-r from-yellow-600 to-orange-600 text-white rounded-lg hover:from-yellow-700 hover:to-orange-700 transition font-medium text-sm shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(z,{size:16}),"Encrypt All Passwords"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users by name or role...",value:p,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(R,{size:16}),"User Accounts",e.jsxs("span",{className:"text-xs font-normal text-gray-500",children:["(",b.length," of ",n.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:b.map(s=>{const r=L(s.password);return e.jsxs("div",{className:`bg-white border ${h===s.id?"border-red-300 shadow-md":"border-gray-200"} rounded-lg p-3 cursor-pointer hover:border-red-200 hover:shadow-sm transition-all`,onClick:()=>f(h===s.id?null:s.id),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:s.name}),s.requirePasswordChange&&e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-medium rounded border border-orange-200",children:"NEEDS CHANGE"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-[11px] font-medium rounded border ${F[s.role]}`,children:s.role.toUpperCase()}),r?e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-green-600",children:[e.jsx(z,{size:10}),"Encrypted"]}):e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-red-600",children:[e.jsx(M,{size:10}),"Plain-text"]})]})]}),e.jsx(D,{size:16,className:`text-gray-400 transition-transform ${h===s.id?"rotate-[-90deg]":""}`})]}),h===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Quick Reset"}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),q(s.id,"1234")},disabled:g,className:"w-full px-3 py-2 bg-orange-50 text-orange-700 border border-orange-200 rounded-lg hover:bg-orange-100 transition text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(W,{size:14}),"Reset to Default (1234)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Set Custom Password"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",placeholder:"Enter new password",value:m,onChange:t=>v(t.target.value),onClick:t=>t.stopPropagation(),onKeyDown:t=>{t.stopPropagation(),t.key==="Enter"&&C(s.id)},disabled:g,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),C(s.id)},disabled:g,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Set"})]})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 bg-gray-50 p-2 rounded border border-gray-200 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Password Status:"}),e.jsx("span",{className:`font-medium ${r?"text-green-600":"text-red-600"}`,children:r?"Encrypted":"Plain-text"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Requires Change:"}),e.jsx("span",{className:`font-medium ${s.requirePasswordChange?"text-orange-600":"text-gray-600"}`,children:s.requirePasswordChange?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"User ID:"}),e.jsx("span",{className:"font-mono",children:s.id})]})]})]})]},s.id)})}),b.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(E,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['No users found matching "',p,'"']})]})]})]})]})};export{H as AdminPanel};
